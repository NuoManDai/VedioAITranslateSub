# Requirements Checklist: 字幕配音分离与日语支持优化

**Feature**: 002-dubbing-subtitle-separation  
**Date**: 2026-01-18

## 功能需求

### 日语 NLP 分句支持

- [x] 分析 WhisperX 日语 ASR 字符级输出格式
- [x] 实现时间间隔检测（> 0.3s 分句）
- [x] 实现标点符号检测（！？。）
- [x] 实现敬语结尾检测（ます、です、ました、でした）
- [x] 实现句尾助词检测（ね、よ、か、な、わ）
- [x] 集成到主处理流程
- [x] 测试日语视频分句效果

### 处理状态恢复

- [x] 定义阶段输出文件映射
- [x] 实现完成状态检测逻辑
- [x] 实现字幕处理完成检测
- [x] 实现配音处理完成检测
- [x] 实现任务状态恢复
- [x] 应用启动时自动恢复状态

### 文件预览功能

- [x] 阶段输出文件列表 API
- [x] 文件内容预览 API
- [x] 支持 JSON 文件预览
- [x] 支持文本文件预览
- [x] 支持 Excel 文件预览
- [x] 支持 SRT 文件预览
- [x] 文件下载 API

### 清理功能

- [x] 字幕处理文件清理 API
- [x] 配音处理文件清理 API
- [x] 全部清理 API
- [x] 清理前确认机制
- [x] 清理后状态重置

### 日志监控

- [x] 日志 API 端点
- [x] 支持按级别过滤
- [x] 支持按来源过滤
- [x] 日志清空功能

### UI 优化

- [x] ProcessingPanel Tab 布局
- [x] 字幕处理 Tab
- [x] 配音处理 Tab
- [x] 重启按钮
- [x] 清理缓存按钮
- [x] ConsolePanel 控制台面板
- [x] StageOutputFiles 文件预览组件
- [x] VideoPlayer 字幕切换
- [x] SettingsModal 组件拆分

### 代码清理

- [x] 删除 st.py
- [x] 删除 install.py
- [x] 删除旧版翻译文件
- [x] 删除 core/st_utils/

## 非功能需求

### 性能

- [x] 日语分句处理时间 < 1s（1000 个 chunk）
- [x] 文件预览响应时间 < 500ms
- [x] 日志查询响应时间 < 200ms

### 兼容性

- [x] 不修改核心处理流程
- [x] 保持与 001 版本的 API 兼容
- [x] 前端组件兼容现有样式

### 可维护性

- [x] 代码注释完整
- [x] 类型定义完整
- [x] 错误处理完善

## 测试要点

### 日语视频处理测试

- [x] 上传日语视频
- [x] ASR 输出正确（字符级对齐）
- [x] 分句结果合理（约 15-30 句/分钟）
- [x] 翻译结果正常

### 状态恢复测试

- [x] 完成部分处理后关闭应用
- [x] 重新打开验证状态正确恢复
- [x] 可以继续处理

### 文件预览测试

- [x] JSON 文件语法高亮
- [x] 文本文件正常显示
- [x] Excel 文件转表格显示
- [x] SRT 文件格式化显示

### 清理功能测试

- [x] 字幕清理不影响配音文件
- [x] 配音清理不影响字幕文件
- [x] 全部清理后状态重置
- [x] 清理后可以重新开始处理

## 验收标准

| 标准 | 状态 |
|------|------|
| 日语视频可正确分句 | ✅ |
| 处理状态可正确恢复 | ✅ |
| 文件可预览下载 | ✅ |
| 清理功能正常工作 | ✅ |
| UI 交互流畅 | ✅ |
| 无回归问题 | ✅ |
